server {
    listen 80;
    server_name localhost;

    root /usr/share/nginx/html;
    index index.html;

    # Serve static files
    location / {
        try_files $uri $uri/ /index.html;
    }

    # Proxy API requests to the backend
    # Assuming the backend service in docker-compose is named 'backend'
    location /api/ {
        # Rewrite /api/x to /x if your backend doesn't expect /api prefix
        # But wait, the frontend code uses http://127.0.0.1:8000 directly in the code I saw earlier.
        # I need to change the frontend to use a relative path or an env var.
        # For now, let's assume we will proxy / to backend if it's an API call?
        # No, usually we proxy /api or specific routes.
        # The current frontend code has `const API_URL = 'http://127.0.0.1:8000';` hardcoded.
        # I should probably update the frontend code to use an environment variable or relative path.
        # If I use relative path (e.g. '/api'), I can proxy it here.
        
        # Let's configure this to proxy requests starting with /api to the backend.
        # However, the backend routes are like /accounts, /orders, etc.
        # So I might need to proxy those specific prefixes or put everything under /api in backend.
        # Changing backend prefix is invasive.
        # Easier: Proxy specific top-level routes used by backend.
        
        # Routes seen: /accounts, /orders, /market
        proxy_pass http://backend:8000/;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }

    location /accounts/ {
        proxy_pass http://backend:8000/accounts/;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }

    location /orders/ {
        proxy_pass http://backend:8000/orders/;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }

    location /market/ {
        proxy_pass http://backend:8000/market/;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }
}
